---
title: 大屏编辑器
date: 2024-02-26 15:03:04
tags:
- js
- vue
- 编辑器
categories:
- 大屏
---

## 大屏

### 标尺实现

#### 画

长标尺、短标尺、

#### 缩放

快捷键

### 蓝图实现

关键词：canvas

### 数据管理实现

#### 定时器管理

init 初始化，销毁定时器

start 初始化定时器、开始setInterval，更新组件

stop 时销毁计时器

add 添加

remove 移除

clear 清空

destroy 销毁

#### 数据源类型

staticData 静态数据

restData 接口配置

subscribeData 订阅数据

#### 数据源管理


### 适配方案

| 方案 | 实现方式 | 优点 | 缺点 |
|:------|:-----:|------:|------:|
| 固定尺寸 |超出部分overflow|简单，适合固定分辨率的设备|不适用于多种分辨率|
| vh、vw | 将px按比例转成vw和vh | 1. 可以动态计算图表的宽高、字体等，灵活性高；2. 当屏幕比例跟ui稿不一致时，不会出现两边留白情况 |需要编写公共转换函数，为每个图表单独做字体、间距、位移的适配，比较麻烦 |
| scale | 通过scale属性根据屏幕大小进行整体的等比缩放 | 1. 代码量少，适配简单 2. 一次处理后不需要各个图表再单独适配 |1. 当屏幕比和ui比例不一致时，会出现周边留白情况 2. 当缩放比例过大时，字体和图片会有一点点失真 3. 当缩放比例过大时，事件热区会偏移 |
| rem + vw vh | 1. 获得rem的基准值 2. 动态计算html根元素的font-size 3. 图表通过vw vh动态计算字体、间距、位移等 | 布局的自适应代码量少，适配简单 | 1. 当屏幕比和ui比例不一致时，会出现周边留白情况 2.图表单独做字体、间距、位移的适配  |

### 图表

图表配置：图表、标题、坐标轴、图例、提示框

### 碎碎念

1. 监听/取消监听写在一块，返回函数的形式取消监听

```js
export default {
  created() {
    document.addEventListener('mouseenter', this.mouseenter)
    this.events = this.initEvent()
  },
  beforeDestroy() {
    document.removeEventListener('mouseenter', this.mouseenter)
    this.events && this.events()
  },
  methods: {
    mouseenter(e) {
      this.$bus.$emit('mouseenter', e)
    },
    // 初始化事件
    initEvent() {
      // 信息
      function message(type, msg) {
        msg && this.$message[type || 'info'](msg)
      }

      this.$bus.$on('message', message)

      return function () {
        this.$bus.$off('message', message)
      }
    },
  },
}
```

2. 当findIndex时，`index > -1` 可以用 `~index` 替代

`~`按位取反，`~index` 为 `-(index + 1)`，当index为-1时，`~index`为0，正好可以用来判断是否存在

## 图表

## 配置

### jsonforms/vue

#### 配置

```json
// schema.json
{
  "type": "object",
  "properties": {
    "vegetables": {
      "type": "boolean"
    },
    "kindOfVegetables": {
      "type": "string",
      "enum": [
        "All",
        "Some",
        "Only potatoes"
      ]
    }
  }
}
```
```json
// uischema.json
{
  "type": "VerticalLayout",
  "elements": [
    {
      "type": "Group",
      "elements": [
        {
          "type": "Control",
          "label": "Eats vegetables?",
          "scope": "#/properties/vegetables"
        },
        {
          "type": "Control",
          "label": "Kind of vegetables",
          "scope": "#/properties/kindOfVegetables",
          "rule": {
            "effect": "HIDE",
            "condition": {
              "scope": "#/properties/vegetables",
              "schema": {
                "const": false
              }
            }
          }
        }
      ]
    }
  ]
}
```

#### 渲染

不是form表单

### vue-json-schema-form

#### 配置

```json
{
    "title": "测试注册表单",
    "description": "A simple form example.",
    "type": "object",
    "required": [
        "firstName",
        "lastName"
    ],
    "ui:order": [
        "lastName",
        "firstName",
        "*",
        "password"
    ],
    "properties": {
        "firstName": {
            "type": "string",
            "title": "First name",
            "default": "Jun"
        },
        "lastName": {
            "type": "string",
            "title": "Last name",
            "ui:options": {
                "description": "请输入你的姓"
            },
            "err:required": "必须输入Last Name"
        },
        "price": {
            "type": "string",
            "description": "最多输入两位小数点，最大值 999999.99",
            "title": "价格",
            "format": "price"
        },
        "age": {
            "type": "integer",
            "title": "Age",
            "maximum": 80,
            "minimum": 16
        },
    }
}
```

分为FormData和Schema两部分，FormData是表单的值，Schema是表单的配置
还有一个uiSchema，用来配置表单的样式、error Schema提示报错

#### 渲染

是form表单，anyof切换后不记录值

特点：可配置列数和label的位置

缺点：组件类别有点少？

### 大屏中的配置

#### 配置
```json
{
  "propertyPanel": {
    "menu": {
      "type": "menu",
      "children": {
        "chart": {
          "name": "图表",
          "mode": "single",
          "children": {
            "chartCfg": {
              "name": "图表设置",
              "type": "group",
              "fold": false,
              "children": {
                "lineStroke": {
                  "type": "stroke",
                  "name": "描边",
                  "components": ["width", "style"],
                  "default": {
                    "width": 2,
                    "style": "solid"
                  }
                },
                "smooth": {
                  "type": "switch",
                  "name": "平滑",
                  "default": false
                },
                "smoothNumber": {
                  "type": "slider",
                  "name": "平滑张力",
                  "min": 0,
                  "max": 1,
                  "step": 0.1,
                  "default": 0.5,
                  "showInPanel": [[".smooth", "$eq", true]]
                },
                "lineSwitch": {
                  "type": "switch",
                  "name": "显示面积",
                  "default": false
                },
                "opacity": {
                  "type": "slider",
                  "name": "透明",
                  "min": 0,
                  "max": 1,
                  "step": 0.1,
                  "default": 0.3,
                  "showInPanel": [[".lineSwitch", "$eq", true]]
                }
              }
            }
          }
        }
      }
    }
  }
}
 
```

#### 渲染

使用vue component渲染组件，每一次修改配置都会实时渲染

不是form表单

### 森x中的配置

#### 配置
```js
[
  {
        key: 'checkbox_8926',
        label: '多选',
        value: [],
        placeholder: '',
        description: '',
        hidden: false,
        readonly: false,
        required: false,
        prefix: '',
        suffix: '',
        prefix_icon: '',
        suffix_icon: '',
        dataset: [
            {
                value: 'cc',
                label: 'cc',
            },
            {
                value: 'dd',
                label: 'dd',
            },
        ],
        type: 'checkbox',
    },
]
```

#### 渲染

特点：业务型组件、互斥、联动
将value和config传入组件，组件根据config的type渲染不同的组件，使用v-if结合component is渲染组件，点击保存时，先校验，将value传出

不是form表单

难点：同时需要保存使用的选择器，避免选择器被删掉