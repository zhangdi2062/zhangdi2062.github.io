---
title: 微前端
tags:
  - js
  - 微前端
categories:
  - 前端
date: 2024-03-26 20:41:27
---

借鉴了微服务，将一个庞大的应用拆分成多个独立的小应用

### iframe方案

- 特点

1. 接入简单
2. 隔离完美

- 不足

1. dom割裂严重，弹窗只能在iframe内部，无法覆盖父级，而且有滚动条
2. 应用之间通信困难
3. 通信复杂，刷新iframe后，状态丢失
4. 白屏时间长

### qiankun(ali)

基于single-spa的微前端方案，通过注册的方式

- 特点
1. 静态资源预加载
2. html entry方式引入子应用，降低了应用改造成本
3. 沙箱隔离，解决了iframe的问题

- 不足
1. 无法支持vite等esmodule脚本运行

- 原理
1. js沙箱，通过proxy拦截window、document等全局变量，使用with改变上下文，实现隔离
2. css沙箱，第一种通过shadow dom实现隔离，第二种类似Vue的scoped，通过动态添加属性实现隔离

### micro-app(jd)

基于webcomponent + qiankun + sandbox的微前端方案

- 特点
1. 使用web component加载子应用

- 不足
1. 仅支持vite版本>=3.0

### EMP(baidu)

基于webpack5 module federation的微前端方案

- 特点
1. webpack联邦编译可以保证所有子应用依赖解耦
2. 应用间共享模块
3. 模块远程ts支持

- 不足
1. 仅支持webpack5
2. 无法实现沙箱隔离
3. 子应用保活、多应用激活无法实现
4. 主、子应用的路由可能发生冲突

- 原理
类似于拆包(模块共享)

### 无界微前端

- 特点
1. 接入简单
2. vite不需要单独处理
3. 预加载
4. 应用保活机制

- 不足
1. 隔离js使用一个空的iframe进行隔离
2. 子应用axios需要自行适配
3. iframe沙箱的src设置了主应用的host，在等待iframe的location.origin从"about:blank"初始化为主应用的host时，采用计时器等待，不太优雅

- 原理
子应用的js代码通过iframe加载，实现隔离，
页面元素通过劫持iframe中的document.querySelectorAll等到webComponent中，实现隔离

### 模块联邦技术

- 特点
1. 跨应用的模块共享
2. 和webpack强耦合，基于webpack5内置插件实现

```javascript
// remote 导出模块的工程
// list.js
export const addList = () => {
    // do something
}

// webpack.config.js
const ModuleFederationPlugin = require('webpack/lib/container/ModuleFederationPlugin');

module.exports = {
  devServer: {
      port: 9001 // remote
  },
  plugins: [
    new ModuleFederationPlugin({
      name: 'remote', // 自定义
      filename: 'remoteEntry.js' // 导出模块的文件名称
      exposes: {
        './addList': './src/list.js' // value为导出模块路径
      }
    })
  ]
}
```

```javascript
// host引用工程
// webpack.config.js
const ModuleFederationPlugin = require('webpack/lib/container/ModuleFederationPlugin');
module.exports = {
  plugins: [
    new ModuleFederationPlugin({
        name: 'host',
        remotes: {
            remote: 'remote@http://localhost:9001/remoteEntry.js'
        }
    })
  ]
}

// 引用的js
import('remote/addList').then(({addList}) => {
    addList();
})
```