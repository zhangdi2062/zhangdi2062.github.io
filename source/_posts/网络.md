---
title: 网络
tags:
  - js
  - node
  - webSocket
categories:
  - 前端
date: 2024-03-20 21:04:54
---

## webSocket

### 前端

事件：

```javascript
open
close
error
message
```

使用方式:

```javascript
const ws = new WebSocket('ws://localhost:8080');
ws.addEventListener('open', function () {})
// 当点击按钮时，发送一条消息
document.querySelector('button').onclick = function () {
  // send接收字符串
  ws.send('hello');
}
ws.addEventListener('message', function (event) {
  // 接收后端client.send发送的消息
  console.log(event.data);
})
```

### 后端

事件：

```javascript
open
close
error
message
connection
```

使用方式：

```javascript
const WebSocket = require('ws');
const server = new WebSocket.Server({ port: 8080 });
server.on('connection', function (ws) {
  ws.on('message', function (message) {
    // 接收前端ws.send发送的消息
    console.log('received: %s', message);
    server.clients.forEach(function each(client) {
      // 广播消息
      if (client.readyState === WebSocket.OPEN) {
        client.send(message);
      }
    })
  })
})
```


## 网络模型

### OSI七层参考模型 & TCP/IP四层模型

![网络模型](网络模型.png)

#### 物理层

- 信道
  - 有线信道，明线，逐渐被电缆取代
  - 有线信道，对称电缆，由多对双绞线组成
  - 有线信道，同轴电缆，电视广播、长途电话、局域网
  - 有线信道，光纤
  - 无线信道，无线电波，蓝牙、WiFi、蜂窝网络

**物理层传输比特流**

#### 数据链路层

通过Mac地址来识别接收者和发送者，并对物理层传输的比特流进行分组，每个分组称为帧。
通过广播的方式来传播，在局域网内所有计算机都能收到消息

windows下查看Mac地址：`ipconfig /all`
Mac下查看Mac地址：`ifconfig`

#### 网络层

- 寻址：依靠ip

- 路由

ip协议在这一层，分为ipv6和ipv4，ipv4的地址是32位的，ipv6的地址是128位的，ipv4的地址已经不够用了，所以出现了ipv6

#### 传输层

- 定义端口号，控流和校验

- TCP：面向连接的协议，可靠，因为有三次握手四次挥手，但会降低效率

- UDP：无连接的协议，不可靠，但效率高，常用于直播、游戏

这一次叫做数据段

#### 会话层

这一层经常被叫做报文

断点下载：会话层包含检查点的机制，可以从断点处继续下载

会话层是在发送方和接收方之间进行通信时创建、维持、终止或端口连接的地方

#### 表示层

这一层经常被叫做报文

- 在网络中的翻译官，负责数据的格式化，如压缩、加密、解密
- 对图片文件等格式进行解码和编码

#### 应用层

这一层经常被叫做报文

- 为应用程序提供服务，如HTTP、FTP、邮件协议SMTP、域名系统DNS、WebSocket长连接、SSH远程登录

### TCP三次握手

![TCP三次握手](TCP三次握手.png)

### TCP四次挥手

![TCP四次挥手](TCP四次挥手.png)

### 浏览器输入url时会发生什么

#### DNS解析

1. 浏览器自身DNS
2. 操作系统DNS
3. 本地host文件
4. 域名服务器
  1. 根域名服务器
  2. 顶级域名服务器
  3. 权威域名服务器（当有CDN时，不再找权威域名，而是从CDN专用的DNS服务器去解析）

#### 什么时候会发起options请求：
1. 跨域时，浏览器会先发起options请求，询问服务器是否允许跨域，服务器返回允许的方法，浏览器再发起真正的请求。
2. 有自定义请求头

#### 缓存

##### 强缓存

- Expires：过期时间，由服务器返回，是一个绝对时间，即使客户端的时间和服务器的时间不一致，也不影响缓存的使用
- Cache-Control：通过指定指令来实现缓存机制
  - max-age=3600，表示缓存的有效时间为3600秒，时间是相对于请求的时间，优先级高于Expires
  - no-cache：不使用强缓存，使用协商缓存
  - no-store：不使用任何缓存，每次都请求服务器
  - public：响应可以被任何对象缓存
  - private：响应只能被单个用户缓存，不能作为共享缓存，如用户的本地浏览器缓存

强缓存第一次从disk缓存中读取，第二次从浏览器内存中读取，内存读取速度更快

##### 协商缓存

- Last-Modified：服务器在响应请求时，告诉浏览器资源的最后修改时间，浏览器下次请求时，会带上If-Modified-Since，服务器会比较这个时间和资源的最后修改时间，如果一致，返回304，浏览器从缓存中读取，如果不一致，返回200，浏览器重新下载
- ETag：服务器响应请求时，返回资源的唯一标识，浏览器下次请求时，会带上If-None-Match，服务器比较这个标识和资源的唯一标识，如果一致，返回304，浏览器从缓存中读取，如果不一致，返回200，浏览器重新下载
- 如果同时存在Last-Modified和ETag，浏览器会优先使用ETag